<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>物业管理</title>

<script src="/kendoui/kendoui/js/jquery.min.js"></script>
<script src="/kendoui/kendoui/js/kendo.all.min.js"></script>
<link href="/kendoui/bootstrap-3.3.7/css/bootstrap.css" rel="stylesheet" type="text/css"/>
<link href="/kendoui/font-awesome-4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="/kendoui/kendoui/styles/kendo.common-bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/kendoui/kendoui/styles/kendo.bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/kendoui/kendoui/styles/kendo.hap.css" rel="stylesheet" type="text/css"/>
<script src="/kendoui/kendoui/js/kendo.hap.js"></script>
<script src="/kendoui/polyfill/es5-shim.min.js"></script>
<script src="/kendoui/polyfill/respond.min.js"></script>

</head>
<body>
<script type="text/javascript">
    var viewModel = kendo.observable({
        model:{
            userInfo:{},
            BuildingInfo:{}
        },
        createFunction: function(){
            $('#Grid').data('kendoGrid').addRow();
        },
        saveFunction: function(){
            $('#Grid').data('kendoGrid').saveChanges();
        },
        queryResource: function(e) {
            $('#Grid').data('kendoGrid').dataSource.page(1);
        }

    });

</script>
<div id="base">
    <div class="demo-section k-content">
        <div id="tabstrip">
            <ul>
                <li class="k-state-active">
                    个人信息
                </li>
                <li>
                    房屋信息
                </li>
                <li>
                    常住人口
                </li>
            </ul>

            <!--个人信息-->
            <div>
                <div class="panel-footer text-left">
                    <span class="btn btn-success" onclick="saveUserInfo()">保存</span>
                    <!--<span class="btn btn-primary" data-bind="click:resetForm"><i class="fa fa-refresh"></i>取消</span>-->
                </div>
                <div class="panel" style="padding: 0px;">
                    <form class="form-horizontal">
                        <div id="baseInfo" class="panel-body">
                        <div style="margin-bottom: 10px;margin-top: 5px">
                            <span class="btn btn-primary" style="width: 150px">户主基本信息</span>
                        </div>
                            <div class="row">
                                <div class="col-sm-4" id="1">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">户主姓名</label>
                                        <div class="col-sm-8">
                                            <input id="userName" name="userName" data-bind="value:model.userInfo.userName" type="text" style="width: 100%" class="k-textbox">
                                            <span style="color: red">*</span>
                                        </div>
                                        <script>
                                            $("#userName").attr("required", true);
                                        </script>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="2">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">账号</label>
                                        <div class="col-sm-8">
                                            <input id="userAccount" name="userAccount" data-bind="value:model.userInfo.userAccount" type="text" style="width: 100%" class="k-textbox">
                                         </div>
                                    </div>
                                </div>

                                <div class="col-sm-4" id="3">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">民族</label>
                                        <div class="col-sm-8">
                                            <input id="userNational" name="userNational" data-bind="value:model.userInfo.userNational" type="text" style="width: 100%" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4" id="4">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">性别</label>
                                        <div class="col-sm-8">
                                            <input id="userGender" name="userGender" data-bind="value:model.userInfo.userGender" type="text" style="width: 100%">
                                        </div>
                                    </div>
                                    <script>
                                        var gender = 'gender';
                                        $.ajax({
                                            type : "GET" ,
                                            url: "/ci/selectByType",
                                            dataType: "json",
                                            data:{commonType : gender},
                                            success: function (data) {
                                                if (data.success) {
                                                    commonInfoSource = eval(data.rows);
                                                    $("#userGender").kendoComboBox({
                                                        dataTextField: "commonName",
                                                        dataValueField: "commonValue",
                                                        dataSource: commonInfoSource,
                                                    });
                                                }
                                            }
                                        });
                                    </script>
                                </div>
                                <div class="col-sm-4" id="5">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">籍贯</label>
                                        <div class="col-sm-8">
                                            <input id="userNativePlace" name="userNativePlace" data-bind="value:model.userInfo.userNativePlace" type="text" style="width: 100%" class="k-textbox">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-4" id="6">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">身份证号</label>
                                        <div class="col-sm-8">
                                            <input id="userIdNumber" name="userIdNumber" data-bind="value:model.userInfo.userIdNumber" type="text" style="width: 100%" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4" id="7">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">身份证地址</label>
                                        <div class="col-sm-8">
                                            <input id="userHomeAddress" name="userHomeAddress" data-bind="value:model.userInfo.userHomeAddress" type="text" style="width: 100%" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="8">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">通讯地址</label>
                                        <div class="col-sm-8">
                                            <input id="userCorrespondenceAddress" name="userCorrespondenceAddress" data-bind="value:model.userInfo.userCorrespondenceAddress"  type="text" style="width: 100%" class="k-textbox">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-sm-4" id="9">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">工作职位</label>
                                        <div class="col-sm-8">
                                            <input id="userDepartment" name="userDepartment" data-bind="value:model.userInfo.userDepartment" type="text" style="width: 100%" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4" id="10">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">工作单位</label>
                                        <div class="col-sm-8">
                                            <input id="userWorkUnits" name="userWorkUnits" type="text" style="width: 100%" data-bind="value:model.userInfo.userWorkUnits" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="11">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">汽车牌号</label>
                                            <div class="col-sm-8">
                                                <input id="userCarBrand" name="userCarBrand"  type="text" style="width: 100%" data-bind="value:model.userInfo.userCarBrand" class="k-textbox">
                                            </div>
                                    </div>
                                </div>

                                <div class="col-sm-4" id="12">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">兴趣爱好</label>
                                            <div class="col-sm-8">
                                                <input id="userHobby" name="userHobby" type="text" style="width: 100%" data-bind="value:model.userInfo.userHobby" class="k-textbox">
                                            </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4" id="15">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">缴费对象</label>
                                        <div class="col-sm-8">
                                            <input id="object" name="object" type="text" style="width: 100%" data-bind="value:model.userInfo.object">
                                        </div>
                                    </div>
                                    <script>
                                        var gender = 'payObject';
                                        $.ajax({
                                            type : "GET" ,
                                            url: "/ci/selectByType",
                                            dataType: "json",
                                            data:{commonType : gender},
                                            success: function (data) {
                                                if (data.success) {
                                                    commonInfoSource = eval(data.rows);
                                                    $("#object").kendoComboBox({
                                                        dataTextField: "commonName",
                                                        dataValueField: "commonValue",
                                                        dataSource: commonInfoSource,
                                                    });
                                                }
                                            }
                                        });
                                    </script>
                                </div>
                                <div class="col-sm-4" id="13">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">忌讳</label>
                                        <div class="col-sm-8">
                                            <input id="userTaboo" name="userTaboo" type="text" style="width: 100%" data-bind="value:model.userInfo.userTaboo" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="14">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">备注</label>
                                            <div class="col-sm-8">
                                                <input id="userNote" name="userNote" type="text" style="width: 100%" data-bind="value:model.userInfo.userNote" class="k-textbox">
                                            </div>
                                    </div>
                                </div>
                            </div>
                            <div style="margin-bottom: 10px;margin-top: 5px">
                                <span class="btn btn-primary" style="width: 150px">联系方式</span>
                            </div>
                            <div class="row">
                                <div class="col-sm-4" id="16">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">固定电话</label>
                                        <div class="col-sm-8">
                                            <input id="fixedTelephone" name="fixedTelephone" type="text" style="width: 100%" data-bind="value:model.userInfo.fixedTelephone" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="17">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">QQ</label>
                                        <div class="col-sm-8">
                                            <input id="userQq" name="userQq" type="text" style="width: 100%" data-bind="value:model.userInfo.userQq" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="18">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">邮箱</label>
                                        <div class="col-sm-8">
                                            <input id="userEmail" name="userEmail" type="text" style="width: 100%" data-bind="value:model.userInfo.userEmail" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4" id="19">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">手机号</label>
                                        <div class="col-sm-8">
                                            <input id="userPhone" name="userPhone" type="text" style="width: 100%" data-bind="value:model.userInfo.userPhone" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="20">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">微信号</label>
                                        <div class="col-sm-8">
                                            <input id="userWeChat" name="userWeChat" type="text" style="width: 100%" data-bind="value:model.userInfo.userWeChat" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="21">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">博客</label>
                                        <div class="col-sm-8">
                                            <input id="userBlog" name="userBlog" type="text" style="width: 100%" data-bind="value:model.userInfo.userBlog" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4" id="22">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">紧急联系人</label>
                                        <div class="col-sm-8">
                                            <input id="emergencyContact" name="emergencyContact" type="text" style="width: 100%" data-bind="value:model.userInfo.emergencyContact" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="23">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">紧急联系人电话</label>
                                        <div class="col-sm-8">
                                            <input id="emergencyContactPhone" name="emergencyContactPhone" type="text" style="width: 100%" data-bind="value:model.userInfo.emergencyContactPhone" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>


            <!--房屋信息-->
            <div>
                <div class="panel-footer text-left">
                    <span class="btn btn-success" onclick="saveBuildingInfo()">保存</span>
                    <!--<span class="btn btn-primary" data-bind="click:resetForm"><i class="fa fa-refresh"></i>取消</span>-->
                </div>
                <div class="panel" style="padding: 0px;">
                    <form class="form-horizontal">
                        <div id="basebuilding" class="panel-body">
                            <div class="col-sm-4" id="24">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">房屋类型</label>
                                    <div class="col-sm-8"><!--data-bind="value:model.BuildingInfo.buildType"-->
                                        <input id="buildType"  type="text" style="width: 100%" data-bind="value:model.BuildingInfo.buildType" >
                                    </div>
                                </div>
                                <script>
                                    TypeDataSource = [];
                                    $.ajax({
                                        type : "POST" ,
                                        url: "/mm/selectAllType",
                                        dataType: "json",
                                        contentType: "application/json",
                                        success: function (data) {
                                            if (data.success) {
                                                TypeDataSource = eval(data.rows);
                                                $("#buildType").kendoComboBox({
                                                    dataTextField: "buildingTypeName",
                                                    dataValueField: "buildingTypeId",
                                                    dataSource: TypeDataSource,
                                                });
                                            }
                                        }
                                    });
                                </script>
                            </div>
                            <div class="col-sm-4" id="25">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">房屋全称</label>
                                    <div class="col-sm-8">
                                        <input id="buildingFullRoom"  type="text" style="width: 100%" data-bind="value:model.BuildingInfo.buildingFullRoom" class="k-textbox">
                                        <script>
                                            $("#buildingFullRoom").attr("disabled", true);
                                        </script>
                                   </div>
                                </div>
                            </div>
                            <div class="col-sm-4" id="26">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">楼栋号</label>
                                    <div class="col-sm-8">
                                        <input id="buildingTheater"  type="text" style="width: 100%" data-bind="value:model.BuildingInfo.buildingTheater" class="k-textbox">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4" id="27">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">单元号</label>
                                        <div class="col-sm-8">
                                            <input id="buildingUnit"  type="text" style="width: 100%" data-bind="value:model.BuildingInfo.buildingUnit" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="28">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">楼层数</label>
                                        <div class="col-sm-8">
                                            <input id="buildingFloor"  type="text" style="width: 100%" data-bind="value:model.BuildingInfo.buildingFloor" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="29">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">门牌号</label>
                                        <div class="col-sm-8">
                                            <input id="buildingRoom"  type="text" style="width: 100%" data-bind="value:model.BuildingInfo.buildingRoom" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-4" id="30">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">房屋使用情况</label>
                                        <div class="col-sm-8">
                                            <input id="housingUsage"  type="text" style="width: 100%" data-bind="value:model.BuildingInfo.housingUsage">
                                        </div>
                                    </div>
                                    <script>
                                        var type = 'HouseUsage';
                                        $.ajax({
                                            type : "GET" ,
                                            url: "/ci/selectByType",
                                            dataType: "json",
                                            data:{commonType : type},
                                            success: function (data) {
                                                if (data.success) {
                                                    commonInfoSource = eval(data.rows);
                                                    $("#housingUsage").kendoComboBox({
                                                        dataTextField: "commonName",
                                                        dataValueField: "commonValue",
                                                        dataSource: commonInfoSource,
                                                    });
                                                }
                                            }
                                        });
                                    </script>
                                </div>
                                <div class="col-sm-4" id="31">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">房屋面积</label>
                                        <div class="col-sm-8">
                                            <input id="buildingArea"  type="text" style="width: 100%" data-bind="value:model.BuildingInfo.buildingArea" class="k-textbox">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-4" id="32">
                                    <div class="form-group">
                                        <label class="col-sm-4 control-label">领房时间</label>
                                        <div class="col-sm-8">
                                            <input id="checkinDate"  type="date" style="width: 100%" data-bind="value:model.BuildingInfo.checkinDate">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-sm-4" id="33">
                                        <div class="form-group">
                                            <label class="col-sm-4 control-label">入住时间</label>
                                            <div class="col-sm-8">
                                                <input id="stayinDate"  type="date" style="width: 100%" data-bind="value:model.BuildingInfo.stayinDate">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <!--常住人口-->
            <div style="height: 450px">

                    <div class="pull-left" id="toolbar-btn" style="padding-bottom:10px;">
                        <span class="btn btn-primary k-grid-add" style="float:left;margin-right:5px;" data-bind="click:createFunction">新建</span>
                        <span class="btn btn-success k-grid-save-changes"  onclick="saveMemberInfo()" style="float:left;margin-right:5px;">保存</span>
                        <span  onclick="deleteData()"  class="btn btn-danger" style="float:left;">删除</span>
                    </div>
                    <script>kendo.bind($('#toolbar-btn'), viewModel);</script>
                    <script>kendo.bind($('#query-form'), viewModel);</script>
                    <script>kendo.bind($('#base'), viewModel);</script>
                    <div style="clear:both">
                        <div id="Grid"></div>
                    </div>


                <script type="text/javascript">
                    var userId=JSON.parse(window.localStorage["editUserId"]||'');
                        dataSource = new kendo.data.DataSource({
                            transport: {
                                read:  {
                                    url: "/mm/selectMemberByUserId?userId="+userId,
                                    type : "POST",
                                    dataType: "json"
                                },
                                update: {
                                    url: "/mm/saveUserMember",
                                    type : "POST" ,
                                    contentType: "application/json"
                                },
                                destroy: {
                                    url: "/mm/deteleUserMember",
                                    type : "POST" ,
                                    contentType: "application/json"
                                },
                                create: {
                                    url: "/mm/saveUserMember",
                                    type : "POST" ,
                                    contentType: "application/json"
                                },
                                parameterMap: function(options, type) {
                                    if (type !== "read" && options.models) {
                                        var datas = Hap.prepareSubmitParameter(options, type)
                                        return kendo.stringify(datas);
                                    } else if (type === "read") {
                                        return Hap.prepareQueryParameter(viewModel.model.toJSON(), options)
                                    }
                                }
                            },
                            batch: true,
                            serverPaging : true,
                            pageSize: 10,
                            schema: {
                                data:'rows',
                                total:'total',
                                model: {
                                    id: "memberId",
                                    fields: {
                                    }
                                }
                            }
                        });

                    $("#Grid").kendoGrid({
                        dataSource: dataSource,
                        height: 400,
                        resizable  : true,
                        scrollable : true,
                        navigatable: false,
                        selectable : 'multiple, rowbox',
                        pageable: {
                            pageSizes:[5, 10, 20, 50],
                            refresh:true,
                            buttonCount:5
                        },
                        columns: [
                            {
                                field: "memberName",
                                title: "姓名",
                                headerAttributes: {
                                    "class": "table-header-cell",
                                    style  : "text-align: center"
                                },
                                width: 120
                            }, {
                                field: "memberRelationship",
                                title: "与户主的关系",
                                headerAttributes: {
                                    "class": "table-header-cell",
                                    style  : "text-align: center"
                                },
                                width: 120
                            }, {
                                field: "memberAge",
                                title: "年龄",
                                headerAttributes: {
                                    "class": "table-header-cell",
                                    style  : "text-align: center"
                                },
                                width: 120
                            }, {
                                field: "memberIdNumber",
                                title: "身份证号",
                                headerAttributes: {
                                    "class": "table-header-cell",
                                    style  : "text-align: center"
                                },
                                width: 120
                            }, {
                                field: "memberWorkUnits",
                                title: "工作单位（学校）",
                                headerAttributes: {
                                    "class": "table-header-cell",
                                    style  : "text-align: center"
                                },
                                width: 120
                            }, {
                                field: "memberPhone",
                                title: "联系电话",
                                headerAttributes: {
                                    "class": "table-header-cell",
                                    style  : "text-align: center"
                                },
                                width: 120
                            }, {
                                field: "memberSituation",
                                title: "老人儿童情况",
                                headerAttributes: {
                                    "class": "table-header-cell",
                                    style  : "text-align: center"
                                },
                                width: 120
                            }, {
                                field: "memberSituationInstructions",
                                title: "老人儿童情况说明",
                                headerAttributes: {
                                    "class": "table-header-cell",
                                    style  : "text-align: center"
                                },
                                width: 120
                            }
                        ],
                        editable: true,
                    });


                    function deleteData() {
                        var grid = $('#Grid').data('kendoGrid');
                        var userInfo = JSON.stringify(grid.selectedDataItems());
                        $.ajax({
                            type: 'POST',
                            url: '/mm/deteleUserMember',
                            dataType: "json",
                            contentType: "application/json",
                            data: userInfo,
                            success: function (data) {
                                if(data.success){
                                    alert("删除成功！")
                                }
                                var grid = $('#Grid').data('kendoGrid');
                                var dataSource = new kendo.data.DataSource({
                                    data: data.rows,
                                    schema: {
                                        total:function (e) {
                                            return data.rows.length;
                                        },
                                        model: {
                                            id: "id",
                                            fields: {
                                            }
                                        }
                                    },
                                    page:1,
                                    pageSize:5
                                });
                                grid.setDataSource(dataSource);
                            }
                        });
                        /*Hap.deleteGridSelection({
                            grid:$('#Grid')
                        });*/

                    };
                    Hap.autoResizeGrid("#Grid");

                </script>

            </div>
        </div>
    </div>

    <style>
        .sunny, .cloudy, .rainy {
            display: block;
            margin: 30px auto 10px;
            width: 128px;
            height: 128px;
        }

        .cloudy{
            background-position: -128px 0;
        }

        .rainy{
            background-position: -256px 0;
        }

        .weather {
            margin: 0 auto 30px;
            text-align: center;
        }

        #tabstrip h2 {
            font-weight: lighter;
            font-size: 5em;
            line-height: 1;
            padding: 0 0 0 30px;
            margin: 0;
        }

        #tabstrip h2 span {
            background: none;
            padding-left: 5px;
            font-size: .3em;
            vertical-align: top;
        }

        #tabstrip p {
            margin: 0;
            padding: 0;
        }
    </style>

    <script>
            $("#tabstrip").kendoTabStrip({
                animation:  {
                    open: {
                        effects: "fadeIn"
                    }
                }
            });


       // var userId='${RequestParameters.userId!0}';
        var userId=JSON.parse(window.localStorage["editUserId"]||'');
        $.ajax({
            type: 'POST',
            url: '/mm/selectBuildById',
            dataType: "json",
            data:{userId:userId},
            success: function (data) {
                viewModel.model.set('BuildingInfo', data.rows[0]);
                var checkInDate = new Date(viewModel.model.BuildingInfo.checkinDate);
                var stayInDate = new Date(viewModel.model.BuildingInfo.stayinDate);
                $("#checkinDate").val(dateStr(checkInDate));
                $("#stayinDate").val(dateStr(stayInDate));
                type = viewModel.model.BuildingInfo.buildingTypeId;
                $("#buildType").data("kendoComboBox").value(type);
            }
        });

        //时间格式化
        function dateStr(oDate) {
            oYear = oDate.getFullYear(),
                oMonth = oDate.getMonth()+1,
                oDay = oDate.getDate(),
                oHour = oDate.getHours(),
                oMin = oDate.getMinutes(),
                oSen = oDate.getSeconds(),
                oTime = oYear +'-'+ getzf(oMonth) +'-'+ getzf(oDay);//最后拼接时间
            return oTime;
        }
        function getzf(num){
            if(parseInt(num) < 10){
                num = '0'+num;
            }
            return num;
        }

        $.ajax({
            type: 'POST',
            url: '/mm/selectByUserId',
            dataType: "json",
            data:{userId:userId},
            success: function (data) {
                viewModel.model.set('userInfo', data.rows[0]);
                gender = viewModel.model.userInfo.userGender;
                $("#userGender").data("kendoComboBox").value(gender);
                object = viewModel.model.userInfo.object;
                $("#object").data("kendoComboBox").value(object);
            }
        });


        function saveMemberInfo() {
            var dataSource = $("#Grid").data('kendoGrid').dataSource.data();
            $.ajax({
                type : "POST" ,
                url: "/mm/addUserMember?userId="+userId,
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify(dataSource),
                success: function (data) {
                    if (data.success) {
                        alert("保存成功！")
                    }
                }
            });

        }


        function saveUserInfo(){
            gender = viewModel.model.userInfo.userGender.commonValue;
            viewModel.model.userInfo.set('userGender',gender);
            object = viewModel.model.userInfo.object.commonValue;
            viewModel.model.userInfo.set('object',object);

            var userInfo = JSON.stringify(viewModel.model.userInfo);
            //console.log(viewModel.model.userInfo)
            $.ajax({
                type: 'POST',
                url: '/mm/saveUserInfo',
                dataType: "json",
                contentType: "application/json",
                data: userInfo,
                success: function (data) {
                    if (data.success) {
                       alert("保存成功！")
                    }
                }
            });
        }

        function saveBuildingInfo(){
            viewModel.model.BuildingInfo.set("buildingTypeId",$("#buildType").data("kendoComboBox").value())
            viewModel.model.BuildingInfo.set("housingUsage",$("#housingUsage").data("kendoComboBox").value())

            var buildingInfo = JSON.stringify(viewModel.model.BuildingInfo);
            $.ajax({
                type: 'POST',
                url: '/mm/insertBuildingInfo',
                dataType: "json",
                contentType: "application/json",
                data: buildingInfo,
                success: function (data) {
                    if (data.success) {
                        alert("保存成功！")
                        $.ajax({
                            type : "POST" ,
                            url: "/mm/selectBuildById",
                            dataType: "json",
                            data: {userId:userId},
                            success: function (data) {
                                if (data.success) {
                                    viewModel.model.set('BuildingInfo',data.rows[0]);
                                    var checkInDate = new Date(viewModel.model.BuildingInfo.checkinDate);
                                    var stayInDate = new Date(viewModel.model.BuildingInfo.stayinDate);
                                    $("#checkinDate").val(dateStr(checkInDate));
                                    $("#stayinDate").val(dateStr(stayInDate));
                                    type = viewModel.model.BuildingInfo.buildingTypeId;
                                    $("#buildType").data("kendoComboBox").value(type);
                                }
                            }
                        });
                    }
                }
            });
        }

       // window.localStorage["editUserId"]=JSON.stringify('');
    </script>
</div>

</body>
</html>


